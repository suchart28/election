<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ส่งรายงาน - ขอนแก่น</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white min-h-screen flex items-center justify-center p-4">
    <div class="bg-slate-900 w-full max-w-md p-8 rounded-3xl border border-slate-800 shadow-2xl">
        <h1 class="text-2xl font-bold text-center text-blue-500 mb-6">รายงานจากพื้นที่</h1>
        <div id="gps-status" class="mb-6 p-4 rounded-2xl bg-slate-800 text-center text-xs border border-slate-700 animate-pulse">กำลังตรวจสอบพิกัด GPS...</div>
        
        <div class="space-y-4">
            <input type="number" id="dist" class="w-full bg-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500" placeholder="ระบุเขตที่ (1-11)">
            <textarea id="msg" class="w-full bg-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500" rows="4" placeholder="รายละเอียดเหตุการณ์..."></textarea>
            <button id="sendBtn" disabled class="w-full bg-blue-600 disabled:bg-slate-700 py-4 rounded-2xl font-bold shadow-lg">ส่งข้อมูลรายงาน</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = { /* ใช้ตัวเดียวกับข้างบน */ };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let coords = null;

        navigator.geolocation.getCurrentPosition(p => {
            const { latitude, longitude } = p.coords;
            // ตรวจสอบรัศมีขอนแก่น (ประมาณ)
            if(latitude > 15.5 && latitude < 17.2 && longitude > 101.5 && longitude < 103.5) {
                coords = { lat: latitude, lng: longitude };
                document.getElementById('gps-status').innerHTML = "✅ พิกัดของคุณอยู่ในเขตจังหวัดขอนแก่น";
                document.getElementById('gps-status').classList.remove('animate-pulse');
                document.getElementById('sendBtn').disabled = false;
            } else {
                document.getElementById('gps-status').innerHTML = "❌ คุณอยู่นอกพื้นที่รายงาน (จ.ขอนแก่น)";
            }
        }, null, { enableHighAccuracy: true });

        document.getElementById('sendBtn').onclick = async function() {
            const d = document.getElementById('dist').value;
            const m = document.getElementById('msg').value;
            if(!d || !m) return alert("กรุณากรอกข้อมูล");
            
            await set(push(ref(db, 'election_reports')), {
                district: d, message: m, lat: coords.lat, lng: coords.lng, timestamp: Date.now()
            });
            alert("ส่งรายงานสำเร็จ");
            document.getElementById('msg').value = "";
        };
    </script>
</body>
</html>
