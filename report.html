<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md rounded-3xl shadow-xl overflow-hidden border border-gray-100">
        <div class="bg-blue-600 p-6 text-white">
            <h1 class="text-2xl font-bold text-center">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</h1>
            <p class="text-blue-100 text-center text-sm mt-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
        </div>
        
        <div class="p-6 space-y-4">
            <div id="gps-status" class="bg-yellow-50 border border-yellow-200 p-3 rounded-xl text-xs text-yellow-700 flex items-center justify-center">
                <span class="animate-pulse mr-2">üìç</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS...
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">‡πÄ‡∏Ç‡∏ï‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</label>
                <input type="number" id="district" class="w-full border-2 border-gray-100 p-3 rounded-xl focus:border-blue-500 outline-none transition" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ç‡∏ï (1-11)">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô / ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label>
                <textarea id="message" class="w-full border-2 border-gray-100 p-3 rounded-xl focus:border-blue-500 outline-none transition" rows="4" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô..."></textarea>
            </div>

            <button id="sendBtn" disabled class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg shadow-blue-200 active:scale-95 transition disabled:bg-gray-300 disabled:shadow-none">
                ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC1ezNueFBjkbToDo-kGo39j49xy7lONfw",
            authDomain: "studio-a33fe.firebaseapp.com",
            projectId: "studio-a33fe",
            databaseURL: "https://studio-a33fe-default-rtdb.firebaseio.com",
            appId: "1:753539109404:web:a5e3c94d8dab8bbde645d9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let userCoords = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        function startGPSTracking() {
            const statusDiv = document.getElementById('gps-status');
            const btn = document.getElementById('sendBtn');

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    userCoords = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                    statusDiv.innerHTML = `‚úÖ ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${userCoords.lat.toFixed(5)}, ${userCoords.lng.toFixed(5)}`;
                    statusDiv.classList.replace('bg-yellow-50', 'bg-green-50');
                    statusDiv.classList.replace('text-yellow-700', 'text-green-700');
                    btn.disabled = false; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ
                }, (err) => {
                    statusDiv.innerHTML = "‚ùå ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á GPS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô";
                    statusDiv.classList.replace('bg-yellow-50', 'bg-red-50');
                    statusDiv.classList.replace('text-yellow-700', 'text-red-700');
                }, { enableHighAccuracy: true });
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î
        startGPSTracking();

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        document.getElementById('sendBtn').onclick = async function() {
            const dist = document.getElementById('district').value;
            const msg = document.getElementById('message').value;
            
            if (!dist || !msg) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏Ç‡∏ï‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°");
            
            this.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
            this.disabled = true;

            try {
                const newReportRef = push(ref(db, 'election_reports'));
                await set(newReportRef, {
                    district: dist,
                    message: msg,
                    lat: userCoords.lat,
                    lng: userCoords.lng,
                    timestamp: Date.now()
                });
                alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                document.getElementById('message').value = "";
                this.innerText = "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
                this.disabled = false;
            } catch (e) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                this.disabled = false;
            }
        };
    </script>
</body>
</html>
