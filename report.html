<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ส่งรายงาน - ขอนแก่น</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-4">
    <div class="max-w-md mx-auto bg-white rounded-2xl shadow-lg p-6 mt-10">
        <h1 class="text-xl font-bold mb-4">ส่งรายงานพื้นที่</h1>
        <div id="status" class="mb-4 p-2 bg-yellow-100 text-xs rounded text-center">รอพิกัด GPS...</div>
        
        <input type="number" id="district" class="w-full border p-2 rounded mb-4" placeholder="เขตเลือกตั้งที่ (1-11)">
        <textarea id="message" class="w-full border p-2 rounded mb-4" rows="3" placeholder="ข้อความรายงาน..."></textarea>
        
        <button id="sendBtn" disabled class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold disabled:bg-gray-300">
            ส่งรายงาน
        </button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC1ezNueFBjkbToDo-kGo39j49xy7lONfw",
            authDomain: "studio-a33fe.firebaseapp.com",
            projectId: "studio-a33fe",
            databaseURL: "https://studio-a33fe-default-rtdb.asia-southeast1.firebasedatabase.app/",
            appId: "1:753539109404:web:a5e3c94d8dab8bbde645d9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let coords = null;

        navigator.geolocation.getCurrentPosition(p => {
            coords = { lat: p.coords.latitude, lng: p.coords.longitude };
            document.getElementById('status').innerText = "✅ GPS พร้อมส่ง";
            document.getElementById('sendBtn').disabled = false;
        }, e => {
            document.getElementById('status').innerText = "❌ กรุณาเปิด GPS";
        });

        document.getElementById('sendBtn').onclick = async function() {
            const d = document.getElementById('district').value;
            const m = document.getElementById('message').value;
            if(!d || !m) return alert("กรอกข้อมูลไม่ครบ");

            this.innerText = "กำลังส่ง...";
            this.disabled = true;

            try {
                await set(push(ref(db, 'election_reports')), {
                    district: d, message: m, lat: coords.lat, lng: coords.lng, timestamp: Date.now()
                });
                alert("ส่งสำเร็จ!");
                document.getElementById('message').value = "";
            } catch (err) {
                alert("ผิดพลาด: " + err.message);
            }
            this.innerText = "ส่งรายงาน";
            this.disabled = false;
        };
    </script>
</body>
</html>
