<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - จัดการรายงาน</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-200 p-6">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-white">จัดการข้อมูลรายงาน</h1>
            <a href="index.html" class="text-sm text-blue-400 hover:underline">กลับหน้าแผนที่</a>
        </div>

        <div class="bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead class="bg-slate-700 text-slate-300 text-sm">
                    <tr>
                        <th class="p-4">เวลา</th>
                        <th class="p-4">เขต</th>
                        <th class="p-4">ข้อความ</th>
                        <th class="p-4 text-center">จัดการ</th>
                    </tr>
                </thead>
                <tbody id="admin-list">
                    </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC1ezNueFBjkbToDo-kGo39j49xy7lONfw",
            authDomain: "studio-a33fe.firebaseapp.com",
            projectId: "studio-a33fe",
            databaseURL: "https://studio-a33fe-default-rtdb.asia-southeast1.firebasedatabase.app/",
            appId: "1:753539109404:web:a5e3c94d8dab8bbde645d9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const reportsRef = ref(db, 'election_reports');

        onValue(reportsRef, (snapshot) => {
            const list = document.getElementById('admin-list');
            list.innerHTML = '';
            const data = snapshot.val();
            
            if (!data) {
                list.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-slate-500">ไม่มีข้อมูลรายงาน</td></tr>';
                return;
            }

            Object.entries(data).reverse().forEach(([id, val]) => {
                const tr = document.createElement('tr');
                tr.className = "border-t border-slate-700 hover:bg-slate-700/50 transition";
                tr.innerHTML = `
                    <td class="p-4 text-xs">${new Date(val.timestamp).toLocaleString('th-TH')}</td>
                    <td class="p-4 font-bold text-blue-400">เขต ${val.district}</td>
                    <td class="p-4 text-sm">${val.message}</td>
                    <td class="p-4 text-center">
                        <button class="del-btn bg-red-600/20 text-red-400 border border-red-600/50 px-3 py-1 rounded-lg hover:bg-red-600 hover:text-white transition" data-id="${id}">
                            ลบ
                        </button>
                    </td>
                `;
                list.appendChild(tr);
            });

            // ตั้งค่าปุ่มลบ
            document.querySelectorAll('.del-btn').forEach(btn => {
                btn.onclick = function() {
                    const reportId = this.getAttribute('data-id');
                    if (confirm('ยืนยันที่จะลบรายงานนี้หรือไม่?')) {
                        remove(ref(db, `election_reports/${reportId}`))
                            .then(() => alert('ลบเรียบร้อยแล้ว'))
                            .catch(err => alert('ผิดพลาด: ' + err.message));
                    }
                };
            });
        });
    </script>
</body>
</html>
