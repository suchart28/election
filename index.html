<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á - ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; font-family: 'Sarabun', sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100%; background: #020617; }
        .leaflet-tile-container { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ */
        .district-office-icon {
            background: #3b82f6;
            border: 2px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
        }

        /* Search Box UI */
        .search-container { position: absolute; top: 120px; left: 20px; z-index: 1000; width: 300px; }
        .search-results { max-height: 250px; overflow-y: auto; display: none; background: rgba(15, 23, 42, 0.95); border: 1px solid #334155; margin-top: 5px; border-radius: 12px; }

        /* Ticker Style */
        .ticker-wrapper { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(15, 23, 42, 0.95); border-top: 1px solid #1e293b; z-index: 2000; height: 40px; overflow: hidden; display: flex; align-items: center; }
        .ticker-label { background: #ef4444; color: white; padding: 0 15px; height: 100%; display: flex; align-items: center; font-weight: bold; z-index: 2001; }
        .ticker-content { display: flex; white-space: nowrap; animation: ticker 50s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body>

    <div class="absolute top-5 left-5 z-[1000]">
        <div class="bg-slate-900/90 backdrop-blur-md p-4 rounded-2xl border border-slate-700 shadow-2xl">
            <h1 class="text-xl font-bold text-white flex items-center">
                <span class="w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse"></span>
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á
            </h1>
            <p class="text-slate-400 text-[10px] tracking-widest mt-1">‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô: ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ 26 ‡πÅ‡∏´‡πà‡∏á</p>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô..." 
            class="w-full bg-slate-900/90 text-white p-3 rounded-xl border border-slate-700 focus:outline-none focus:ring-2 ring-blue-500 shadow-xl">
        <div id="searchResults" class="search-results shadow-2xl text-sm"></div>
    </div>

    <div id="map"></div>

    <div class="ticker-wrapper">
        <div class="ticker-label">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
        <div id="ticker-move" class="ticker-content text-slate-400 text-sm"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC1ezNueFBjkbToDo-kGo39j49xy7lONfw",
            authDomain: "studio-a33fe.firebaseapp.com",
            projectId: "studio-a33fe",
            databaseURL: "https://studio-a33fe-default-rtdb.asia-southeast1.firebasedatabase.app/",
            appId: "1:753539109404:web:a5e3c94d8dab8bbde645d9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const map = L.map('map', { zoomControl: false }).setView([16.4419, 102.8359], 9);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ 26 ‡πÅ‡∏´‡πà‡∏á‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ---
        const offices = [
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", lat: 16.4425, lng: 102.8272 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡∏ù‡∏≤‡∏á", lat: 16.4528, lng: 102.6369 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏û‡∏£‡∏∞‡∏¢‡∏∑‡∏ô", lat: 16.3264, lng: 102.6481 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡∏≠", lat: 16.4883, lng: 102.4339 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ä‡∏∏‡∏°‡πÅ‡∏û", lat: 16.5447, lng: 102.0650 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π", lat: 16.7844, lng: 102.1628 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ô‡πâ‡∏≥‡∏û‡∏≠‡∏á", lat: 16.7022, lng: 102.8547 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏±‡∏ï‡∏ô‡πå", lat: 16.7589, lng: 102.6322 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏Å‡∏£‡∏∞‡∏ô‡∏ß‡∏ô", lat: 16.7078, lng: 103.0825 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ú‡πà", lat: 16.0603, lng: 102.7306 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏õ‡∏∑‡∏≠‡∏¢‡∏ô‡πâ‡∏≠‡∏¢", lat: 15.8719, lng: 102.9039 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏û‡∏•", lat: 15.8164, lng: 102.5925 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏ß‡∏á‡∏ô‡πâ‡∏≠‡∏¢", lat: 15.7917, lng: 102.4172 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏ß‡∏á‡πÉ‡∏´‡∏ç‡πà", lat: 15.9525, lng: 102.5050 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ä‡∏•‡∏ö‡∏ñ", lat: 16.0864, lng: 102.5206 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏°‡∏±‡∏ç‡∏à‡∏≤‡∏Ñ‡∏µ‡∏£‡∏µ", lat: 16.1261, lng: 102.5358 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏´‡∏ô‡∏≠‡∏á‡∏™‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á", lat: 15.7336, lng: 102.7933 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏†‡∏π‡πÄ‡∏ß‡∏µ‡∏¢‡∏á", lat: 16.6517, lng: 102.4386 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏†‡∏π‡∏ú‡∏≤‡∏°‡πà‡∏≤‡∏ô", lat: 16.6111, lng: 101.9058 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ã‡∏≥‡∏™‡∏π‡∏á", lat: 16.6067, lng: 103.0514 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÇ‡∏Ñ‡∏Å‡πÇ‡∏û‡∏ò‡∏¥‡πå‡πÑ‡∏ä‡∏¢", lat: 16.0803, lng: 102.3858 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏´‡∏ô‡∏≠‡∏á‡∏ô‡∏≤‡∏Ñ‡∏≥", lat: 16.8058, lng: 102.3439 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏Æ‡∏î", lat: 16.2056, lng: 102.7483 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÇ‡∏ô‡∏ô‡∏®‡∏¥‡∏•‡∏≤", lat: 15.9717, lng: 102.6681 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏Ç‡∏≤‡∏™‡∏ß‡∏ô‡∏Å‡∏ß‡∏≤‡∏á", lat: 16.8583, lng: 102.8631 },
            { name: "‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡πÄ‡∏Å‡πà‡∏≤", lat: 16.6711, lng: 102.3086 }
        ];

        const officeMarkers = {};
        offices.forEach(o => {
            const m = L.circleMarker([o.lat, o.lng], {
                radius: 8, fillColor: "#3b82f6", color: "#fff", weight: 2, fillOpacity: 0.8
            }).bindPopup(`<b>${o.name}</b>`).addTo(map);
            officeMarkers[o.name] = m;
        });

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ---
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');

        searchInput.oninput = () => {
            const query = searchInput.value;
            searchResults.innerHTML = '';
            if (!query) { searchResults.style.display = 'none'; return; }

            const filtered = offices.filter(o => o.name.includes(query));
            if (filtered.length > 0) {
                searchResults.style.display = 'block';
                filtered.forEach(o => {
                    const div = document.createElement('div');
                    div.className = "p-3 hover:bg-slate-800 cursor-pointer border-b border-slate-800 text-slate-300";
                    div.innerText = o.name;
                    div.onclick = () => {
                        map.setView([o.lat, o.lng], 14);
                        officeMarkers[o.name].openPopup();
                        searchResults.style.display = 'none';
                        searchInput.value = o.name;
                    };
                    searchResults.appendChild(div);
                });
            } else { searchResults.style.display = 'none'; }
        };

        // ‡πÇ‡∏´‡∏•‡∏î GeoJSON ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÄ‡∏Ç‡∏ï‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
        fetch('khon kaen.geojson').then(res => res.json()).then(data => {
            L.geoJSON(data, {
                style: (f) => ({ 
                    fillColor: f.properties.fill || "#1e293b", 
                    fillOpacity: 0.15, color: "#334155", weight: 1 
                })
            }).addTo(map);
        });

        // Ticker Reports (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
        onValue(ref(db, 'election_reports'), (snapshot) => {
            const reports = Object.values(snapshot.val() || {}).reverse().slice(0, 10);
            document.getElementById('ticker-move').innerHTML = reports.map(r => `
                <span class="px-10"><b>‡πÄ‡∏Ç‡∏ï ${r.district}:</b> ${r.message}</span>
            `).join('');
        });
    </script>
</body>
</html>
